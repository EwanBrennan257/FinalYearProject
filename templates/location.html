{% extends "base.html" %}
{% block title %}{{ location.name }} · Cork Photographers{% endblock %}
<!-- everything below renders inside base.html template-->
{% block content %}
<h2 style="margin-top:0">{{ location.name }}</h2>
<p class="muted">Lat {{ "%.5f"|format(location.lat) }}, Lon {{ "%.5f"|format(location.lon) }}</p>
<!-- shows sunrise and sunset for location -->
<div class="grid" style="margin-top:1rem">
  <section class="card">
    <h3>Sunrise / Sunset (today)</h3>
    {% if sun %}
      <p>Sunrise: <strong>{{ sun.sunrise }}</strong></p>
      <p>Sunset: <strong>{{ sun.sunset }}</strong></p>
    {% else %}
      <p class="muted">No sun data.</p>
    {% endif %}
  </section>
<!-- table of weather for next few hours, get_weather_hours returns a list of dicts
 only shows first six rows to keep small-->
  <section class="card">
    <h3>Weather (next few hours)</h3>
    {% if weather %}
      <table>
        <thead><tr><th>Time</th><th>°C</th><th>Wind</th><th>Rain</th></tr></thead>
        <tbody>
        {% for row in weather[:6] %}
          <tr><td>{{ row.time }}</td><td>{{ row.temp }}</td><td>{{ row.wind }}</td><td>{{ row.precip }}</td></tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No weather data.</p>
    {% endif %}
  </section>
  <section class="card">
  <h3>Tide (Cork — today)</h3>
  {% if tide_error %}
    <p class="muted">{{ tide_error }}</p>
  {% else %}
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
      <div>
        <h4>High</h4>
        <ul>
          {% for t in high_tides %}
            <li>{{ t.time }}{% if t.height is not none %} — {{ '%.2f'|format(t.height) }} m{% endif %}</li>
          {% endfor %}
        </ul>
      </div>
      <div>
        <h4>Low</h4>
        <ul>
          {% for t in low_tides %}
            <li>{{ t.time }}{% if t.height is not none %} — {{ '%.2f'|format(t.height) }} m{% endif %}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    <p class="muted" style="margin-top:.5rem">Source: tide-forecast.com — for planning only.</p>
  {% endif %}
</section>

<hr>

<h2>Reviews</h2>

{% if avg_rating %}
  <p class="muted">
    Average rating: {{ "%.1f"|format(avg_rating) }} / 5 ({{ review_count }} review{{ "" if review_count==1 else "s" }})
  </p>
{% else %}
  <p class="muted">No reviews yet.</p>
{% endif %}

{% if current_user.is_authenticated %}
  <div class="card">
    <h3 style="margin-top:0;">Leave a review</h3>

    <form method="post" action="{{ url_for('add_review', slug=location.slug) }}">
      <label>Rating</label>
      <div style="margin-bottom:.5rem;">
        {% for n in range(5, 0, -1) %}
          <label style="margin-right:.75rem;">
            <input type="radio" name="rating" value="{{ n }}" required>
            {{ n }}★
          </label>
        {% endfor %}
      </div>

      <label for="body">Comment</label>
      <input id="body" name="body" type="text" maxlength="1000" required>

      <button class="btn" type="submit">Submit review</button>
    </form>
  </div>
{% else %}
  <p class="muted">
    <a href="{{ url_for('login') }}">Log in</a> to leave a review.
  </p>
{% endif %}

<div style="margin-top:1rem;">
  {% for r in reviews %}
    <div class="card">
      <div class="muted" style="display:flex; justify-content:space-between;">
        <span>
          {{ r.user.email }}
          —
          {% set stars = "★" * r.rating + "☆" * (5 - r.rating) %}
          {{ stars }}
        </span>
        <span>{{ r.created_at.strftime("%Y-%m-%d %H:%M") }}</span>
      </div>
      <p style="margin-bottom:0;">{{ r.body }}</p>
    </div>
  {% endfor %}
</div>


</div>
{% endblock %}
