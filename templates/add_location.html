{% extends "base.html" %}
{% block title %}Add Location{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-6">
    <h2>Add a Location</h2>
    <form method="post" id="locationForm">
      <div class="form-group">
        <label for="name">Name</label>
        <input id="name" name="name" required type="text" class="form-control" placeholder="e.g. Example Beach">
      </div>
      
      <div class="form-group">
        <label for="lat">Latitude</label>
        <input id="lat" name="lat" required type="number" step="any" class="form-control" readonly>
      </div>
      
      <div class="form-group">
        <label for="lon">Longitude</label>
        <input id="lon" name="lon" required type="number" step="any" class="form-control" readonly>
      </div>
      
      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" class="form-control" rows="3" placeholder="Optional notes about this location"></textarea>
      </div>
      
      <button class="btn btn-primary" type="submit">Save Location</button>
      <a href="{{ url_for('home') }}" class="btn btn-secondary">Cancel</a>
    </form>
  </div>
  
  <div class="col-md-6">
    <h2>üìç Click on Map</h2>
    <p class="text-muted">Click anywhere on the map to select coordinates</p>
    <div id="map-picker" style="height: 500px; width: 100%; border-radius: 8px; border: 2px solid #dee2e6;"></div>
    <p class="text-muted mt-2" id="map-instructions">
      <small>üí° Click on the map to place a marker and automatically fill in coordinates.</small>
    </p>
  </div>
</div>

<script>
let map;
let marker;

function initMapPicker() {
  // defaults to cork
  const cork = { lat: 51.8969, lng: -8.4863 };
  
  map = new google.maps.Map(document.getElementById('map-picker'), {
    zoom: 11,
    center: cork,
    mapTypeId: 'terrain'
  });
  

  map.addListener('click', function(event) {
    placeMarker(event.latLng);
  });
}

function placeMarker(location) {
  // removes old marker
  if (marker) {
    marker.setMap(null);
  }
  
  // creates new marker
  marker = new google.maps.Marker({
    position: location,
    map: map,
    animation: google.maps.Animation.DROP
  });
  
  // update form fields
  document.getElementById('lat').value = location.lat().toFixed(6);
  document.getElementById('lon').value = location.lng().toFixed(6);
  
  // update instructions
  document.getElementById('map-instructions').innerHTML = 
    `<small>‚úÖ Location selected: ${location.lat().toFixed(6)}, ${location.lng().toFixed(6)}</small>`;
}
</script>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMapPicker">
</script>
{% endblock %}
